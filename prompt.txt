Nu vill jag skapa en docker-compose som bygger och kör hela min lösning i ett docker nätverk:

<./janus_webrtc/docker-compose.yaml>
version: '3'
services:
  janus:
    image: webrtc
    build: .
    ports:
      - 8088:8088
      - 8188:8188
</./janus_webrtc/docker-compose.yaml>

<./janus_webrtc/Dockerfile>
FROM alpine

COPY dependencies.sh /usr/local/bin/dependencies.sh
RUN chmod +x /usr/local/bin/dependencies.sh

RUN /usr/local/bin/dependencies.sh

WORKDIR /home/
RUN git clone https://github.com/meetecho/janus-gateway.git

WORKDIR /home/janus-gateway

RUN ./autogen.sh
RUN ./configure --prefix=/opt/janus
RUN make
RUN make install

RUN make configs

CMD ["/opt/janus/bin/janus"]
</./janus_webrtc/Dockerfile>

<./network/Dockerfile>
# syntax=docker/dockerfile:1

############################
# 1) Builder stage
############################
FROM ubuntu:24.04 AS builder

ARG DEBIAN_FRONTEND=noninteractive
ARG BOOST_VERSION=1.90.0
# BOOST_VERSION with underscores for tarball path
ARG BOOST_VERSION_U=1_90_0

# Install build tools + download tools + OpenSSL dev headers
RUN apt-get update && apt-get install -y --no-install-recommends \
    ca-certificates \
    git \
    curl \
    wget \
    tar \
    xz-utils \
    pkg-config \
    build-essential \
    cmake \
    ninja-build \
    libssl-dev \
 && rm -rf /var/lib/apt/lists/*

WORKDIR /deps

# Download and extract Boost sources (only used in builder stage)
RUN wget -q https://archives.boost.io/release/${BOOST_VERSION}/source/boost_${BOOST_VERSION_U}.tar.gz \
 && tar -xzf boost_${BOOST_VERSION_U}.tar.gz \
 && rm boost_${BOOST_VERSION_U}.tar.gz

# Copy project
WORKDIR /src
COPY . .

# Configure & build
# Pass BOOST_ROOT so CMake can find headers for our boost_charconv build
RUN cmake -S . -B build -G Ninja \
    -DCMAKE_BUILD_TYPE=Release \
    -DBOOST_ROOT=/deps/boost_${BOOST_VERSION_U} \
 && cmake --build build --config Release

############################
# 2) Runtime stage (small)
############################
FROM ubuntu:24.04 AS runtime

ARG DEBIAN_FRONTEND=noninteractive

# Only runtime libs (OpenSSL runtime). If your binary is fully static, you may not need these.
RUN apt-get update && apt-get install -y --no-install-recommends \
    ca-certificates \
    libssl3 \
 && rm -rf /var/lib/apt/lists/*

WORKDIR /app

# Copy the built binary
COPY --from=builder /src/build/lynks_backend /usr/local/bin/lynks_backend

# (Optional) if your app needs runtime files/configs, copy them too:
# COPY --from=builder /src/secret /app/secret

# Expose port if relevant (change/remove)
EXPOSE 60000

# Start server
ENTRYPOINT ["/usr/local/bin/lynks_backend"]
</./network/Dockerfile>

<./network/docker-compose.yaml>
services:
  lynks_backend:
    build:
      context: .
      dockerfile: Dockerfile
    image: lynks_backend:latest
    command: ["60000"]
    container_name: lynks_backend
    restart: unless-stopped
    ports:
      - "60000:60000"
    environment:
      # Lägg era riktiga envs här
      # EXAMPLE:
      # LOG_LEVEL: "info"
      TZ: "Europe/Stockholm"
    # Om ni behöver config/secret som filer:
    # volumes:
    #   - ./config:/app/config:ro
</./network/docker-compose.yaml>

<./mysql/Dockerfile>
FROM mysql:8.0

# Kopiera init-sql till MySQLs auto-init-mapp
# Allt som ligger här körs i alfabetisk ordning vid första start (när datavolymen är tom).
COPY ./scripts/ /docker-entrypoint-initdb.d/

# (valfritt) säkerställ läsbart
RUN chmod -R 644 /docker-entrypoint-initdb.d/*.sql
</./mysql/Dockerfile>

<./docker-compose.yaml>
services:
  mysql:
    build:
      context: ./mysql
    container_name: lynks-mysql
    environment:
      MYSQL_ROOT_PASSWORD: rootpassword
      MYSQL_DATABASE: lynks_db
      # MYSQL_USER / MYSQL_PASSWORD kan du använda, men eftersom du skapar admin själv i SQL
      # låter vi det vara och skapar användaren i 02_create_admin.sql
    ports:
      - "3307:3306"
    volumes:
      - mysql_data:/var/lib/mysql
    healthcheck:
      test: ["CMD", "mysqladmin", "ping", "-h", "127.0.0.1", "-prootpassword"]
      interval: 5s
      timeout: 3s
      retries: 20
    restart: unless-stopped

volumes:
  mysql_data:
</./docker-compose.yaml>